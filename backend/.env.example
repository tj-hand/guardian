# ========================================
# Email Token Authentication - Backend Configuration
# ========================================
# Copy this file to .env and update values for your environment
# IMPORTANT: Never commit .env file to version control!

# ========================================
# Application Settings
# ========================================

# Application name displayed in API docs and emails
APP_NAME=Email Token Auth

# Environment: development, staging, or production
APP_ENV=development

# Secret key for JWT tokens and encryption
# CRITICAL: Generate a secure key for production using: openssl rand -hex 32
# This MUST be changed from the default value in production!
SECRET_KEY=dev-secret-key-change-in-production

# ========================================
# Authentication Token Settings
# ========================================

# Token expiry time in minutes (valid range: 1-60)
TOKEN_EXPIRY_MINUTES=2

# Length of authentication token in digits (valid range: 4-8)
TOKEN_LENGTH=6

# ========================================
# Database Configuration - PostgreSQL
# ========================================
# These settings configure the PostgreSQL database connection
# In Docker Compose, use the service name as POSTGRES_HOST

# PostgreSQL username
POSTGRES_USER=authuser

# PostgreSQL password
# IMPORTANT: Use a strong password in production!
POSTGRES_PASSWORD=authpass123

# PostgreSQL host (use 'database' for Docker Compose, or IP/hostname for external DB)
POSTGRES_HOST=database

# PostgreSQL port (default: 5432)
POSTGRES_PORT=5432

# PostgreSQL database name
POSTGRES_DB=auth_db

# ========================================
# Email Service - Mailgun Configuration
# ========================================
# Mailgun is used to send authentication token emails
# Sign up at https://www.mailgun.com/ to get API credentials

# Mailgun API key (get from Mailgun dashboard)
# Leave empty for development/testing (emails will be logged but not sent)
MAILGUN_API_KEY=

# Mailgun domain (e.g., mg.yourdomain.com)
MAILGUN_DOMAIN=

# From email address for authentication emails
MAILGUN_FROM_EMAIL=noreply@example.com

# From name displayed in authentication emails
MAILGUN_FROM_NAME=Email Token Auth

# ========================================
# CORS Settings
# ========================================
# Comma-separated list of allowed origins for CORS
# Add your frontend URLs here (development and production)

ALLOWED_ORIGINS=http://localhost:5173,http://localhost:5174,http://localhost:8080

# ========================================
# Session Configuration
# ========================================

# Session expiry time in days (valid range: 1-30)
SESSION_EXPIRY_DAYS=7

# ========================================
# Rate Limiting
# ========================================
# Prevent abuse by limiting token requests per email address

# Maximum number of token requests per email within the time window
RATE_LIMIT_REQUESTS=3

# Rate limit time window in minutes
RATE_LIMIT_WINDOW_MINUTES=15

# ========================================
# Email Whitelist
# ========================================
# Control whether only registered users can request authentication tokens
#
# When enabled (true): Only email addresses that exist in the users table
#                      can request authentication tokens. This is the
#                      recommended secure mode.
#
# When disabled (false): Any email address can request a token, and users
#                        are automatically created (open registration mode).
#
# Bootstrap process when enabled:
# 1. Temporarily set ENABLE_EMAIL_WHITELIST=false
# 2. Use the application to create first user account via token request
# 3. Re-enable: ENABLE_EMAIL_WHITELIST=true
# 4. Future users must be manually added to database by administrator
#
# Alternative bootstrap (manual SQL):
# INSERT INTO users (id, email, is_active, created_at, updated_at)
# VALUES (gen_random_uuid(), 'admin@example.com', true, now(), now());

ENABLE_EMAIL_WHITELIST=true

# ========================================
# API Configuration
# ========================================

# API version 1 prefix (default: /v1)
# NOTE: Gateway strips /api prefix, so backend routes are registered under /v1
# Requests to http://gateway/api/v1/* are forwarded as /v1/* to backend
API_V1_PREFIX=/v1

# ========================================
# Branding Configuration (White-Label)
# ========================================
# Customize branding for white-label deployments

# Company/brand name displayed in emails and communications
COMPANY_NAME=Email Token Auth

# Support email address displayed in emails
SUPPORT_EMAIL=support@example.com

# Primary brand color (hex format) for email templates
BRAND_PRIMARY_COLOR=#007bff

# Path to email template directory (relative to app root)
EMAIL_TEMPLATE_PATH=app/templates/email

# ========================================
# Development Notes
# ========================================
#
# For local development:
# 1. Copy this file to .env: cp .env.example .env
# 2. Update POSTGRES_PASSWORD with a secure password
# 3. Leave MAILGUN settings empty (emails will be logged)
# 4. Ensure ALLOWED_ORIGINS includes your frontend dev server URL
#
# For production deployment:
# 1. Generate secure SECRET_KEY: openssl rand -hex 32
# 2. Use strong POSTGRES_PASSWORD (20+ characters, mixed case, numbers, symbols)
# 3. Configure Mailgun credentials (MAILGUN_API_KEY, MAILGUN_DOMAIN)
# 4. Update ALLOWED_ORIGINS with production frontend URL(s)
# 5. Set APP_ENV=production
# 6. Store sensitive values in secure secret management (e.g., Azure Key Vault)
#
# Security checklist:
# - Never commit .env file to git
# - Use different secrets for each environment
# - Rotate secrets regularly
# - Use HTTPS only in production
# - Enable firewall rules for database access
# - Monitor authentication logs for suspicious activity
